<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Aulas y Dispositivos - IoT</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f4f2f8;
      color: #222;
    }

    /* ================= HEADER ================= */
    header {
      background: linear-gradient(90deg, #4B0082, #800080);
      padding: 20px 30px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    header h4 {
      color: #fff;
      font-weight: 700;
      font-size: 1.8rem;
      margin: 0;
    }

    .btn-back {
      background: #fff;
      color: #4B0082;
      font-weight: 600;
      border-radius: 12px;
      padding: 8px 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      transition: transform 0.2s, background-color 0.3s, color 0.3s;
      text-decoration: none !important;
    }

    .btn-back:hover {
      transform: translateY(-4px);
      background-color: #9370DB;
      color: #fff;
    }

    /* ================= SECCIÓN ================= */
    .section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .title-line {
      width: 6px;
      height: 28px;
      border-radius: 6px;
      background: #4B0082;
    }

    .section-title {
      font-size: 1.6rem;
      font-weight: 700;
      color: #4B0082;
      margin: 0;
    }

    /* ================= CAJA PRINCIPAL ================= */
    .content-box {
      background: #fff;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      width: 100%;
    }

    .d-flex.mb-3 input {
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1) inset;
      border: 1px solid #ccc;
      padding: 8px 12px;
      transition: 0.3s;
    }

    .d-flex.mb-3 input:focus {
      outline: none;
      border-color: #4B0082;
      box-shadow: 0 2px 8px rgba(75,0,130,0.3) inset;
    }

    .btn-main {
      background: #4B0082;
      color: #fff;
      font-weight: 600;
      border-radius: 12px;
      padding: 8px 20px;
      transition: transform 0.2s, background-color 0.3s;
    }

    .btn-main:hover {
      transform: translateY(-2px);
      background-color: #9370DB;
    }

    /* ================= TABLA ================= */
    .scroll-area {
      overflow: auto;
      max-height: 430px;
    }

    table {
      border-collapse: separate !important;
      border-spacing: 0 8px !important;
      width: 100%;
    }

    thead th {
      background: #4B0082;
      color: #fff;
      padding: 12px 10px;
      border: 0;
      text-align: center;
      font-weight: 600;
    }

    tbody tr {
      background: #fff;
      border-radius: 8px;
    }

    tbody td {
      background: #fff;
      padding: 10px 8px;
      vertical-align: middle;
      border-top: 1px solid #e9ecef;
      border-bottom: 1px solid #e9ecef;
      text-align: center;
    }

    /* Badges de estado */
    .badge-activo {
      background: #198754;
      color: white;
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
    }

    .badge-off {
      background: #dc3545;
      color: white;
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
    }

    .btn-outline-primary {
      border-radius: 10px;
    }

    .btn-outline-danger {
      border-radius: 10px;
    }
  </style>
</head>

<body>

<header>
  <div class="container d-flex justify-content-between align-items-center">
    <h4>Aulas y Dispositivos</h4>
    <a href="dashboard.html" class="btn-back"><i class="bi bi-arrow-left"></i> Volver</a>
  </div>
</header>

<div class="container mt-4">

  <div class="section-header">
    <div class="title-line"></div>
    <h5 class="section-title">Administrar Aulas / Dispositivos</h5>
  </div>

  <div class="d-flex mb-3 justify-content-between flex-wrap">
    <input id="searchAula" class="form-control" style="max-width:280px" placeholder="Buscar aula o ID...">
    <button id="btnAddAula" class="btn btn-main">+ Agregar Aula</button>
  </div>

  <div class="content-box">
    <div class="scroll-area">
      <table class="table table-sm">
        <thead>
          <tr>
            <th>Aula</th>
            <th>ID del Dispositivo</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="tbAulas"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modal fade" id="modalAula" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Aula / Dispositivo</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <form id="formAula">
          <input type="hidden" id="aulaId">
          <label class="form-label">Código de Aula</label>
          <input id="aulaName" class="form-control" required placeholder="Ej: 3-105">

          <label class="form-label mt-2">ID del Dispositivo</label>
          <input id="aulaDev" class="form-control" required placeholder="Ej: ESP-105-A">

          <label class="form-label mt-2">Estado</label>
          <select id="aulaEstado" class="form-select">
            <option value="Activo">Activo</option>
            <option value="Desconectado">Desconectado</option>
          </select>
        </form>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button class="btn btn-main" id="saveAula">Guardar</button>
      </div>

    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
function getAulas(){ return JSON.parse(localStorage.getItem("aulas") || "[]"); }
function saveAulas(arr){ localStorage.setItem("aulas", JSON.stringify(arr)); }

if(!localStorage.getItem("aulas")){
  saveAulas([
    {id:"a1", aula:"3-105", device:"ESP-105-A", estado:"Activo"},
    {id:"a2", aula:"3-201", device:"ESP-201-B", estado:"Desconectado"}
  ]);
}

function renderAulas(){
  const tbody = document.getElementById("tbAulas");
  const search = document.getElementById("searchAula").value.toLowerCase();
  tbody.innerHTML = "";

  getAulas().forEach(a=>{
    if(search &&
       !a.aula.toLowerCase().includes(search) &&
       !a.device.toLowerCase().includes(search)
    ) return;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${a.aula}</td>
      <td>${a.device}</td>
      <td>${a.estado === "Activo"
          ? '<span class="badge-activo">Activo</span>'
          : '<span class="badge-off">Desconectado</span>'}
      </td>
      <td>
        <button class="btn btn-sm btn-outline-primary" onclick="editAula('${a.id}')">Editar</button>
        <button class="btn btn-sm btn-outline-danger ms-2" onclick="delAula('${a.id}')">Eliminar</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

renderAulas();

const modalAula = new bootstrap.Modal(document.getElementById("modalAula"));

document.getElementById("btnAddAula").addEventListener("click", ()=>{
  document.getElementById("formAula").reset();
  document.getElementById("aulaId").value = "";
  modalAula.show();
});

function editAula(id){
  const a = getAulas().find(x=>x.id===id);
  document.getElementById("aulaId").value = a.id;
  document.getElementById("aulaName").value = a.aula;
  document.getElementById("aulaDev").value = a.device;
  document.getElementById("aulaEstado").value = a.estado;
  modalAula.show();
}

function delAula(id){
  if(!confirm("¿Eliminar aula?")) return;
  saveAulas(getAulas().filter(x=>x.id!==id));
  renderAulas();
}

document.getElementById("saveAula").addEventListener("click", ()=>{
  const id = document.getElementById("aulaId").value;
  const aula = document.getElementById("aulaName").value;
  const device = document.getElementById("aulaDev").value;
  const estado = document.getElementById("aulaEstado").value;
  let aulas = getAulas();

  if(id){
    const i = aulas.findIndex(x=>x.id===id);
    aulas[i] = {id,aula,device,estado};
  } else {
    aulas.push({id:"a"+Date.now(),aula,device,estado});
  }

  saveAulas(aulas);
  modalAula.hide();
  renderAulas();
});

document.getElementById("searchAula").addEventListener("input", renderAulas);
</script>

</body>
</html>
